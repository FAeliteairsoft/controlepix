<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>F.A TEAM ELITE – Painel de Contribuições</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --cor-primaria: #012040;
      --cor-secundaria: #f2c200;
    }
    body {
      background: var(--cor-primaria) url('logo_fa_team_elite.png') no-repeat center 120px/240px;
      min-height:100vh; color:#fff;
    }
    .btn { border-radius:.75rem; padding:.5rem 1rem; font-weight:600; transition:all .2s; }
    .btn-primary { background:var(--cor-secundaria); color:var(--cor-primaria); }
    .btn-primary:hover { filter:brightness(1.1); }
    input { border-radius:.5rem; padding:.5rem .75rem; color:#111827; width:100%; }
  </style>
</head>
<body class="flex flex-col items-center py-12">
  <header class="mb-8 text-center"><h1 class="text-3xl font-extrabold">Contribuição da Tropa – Missão Financeira</h1></header>
  <div id="login-card" class="bg-white/10 backdrop-blur p-6 rounded-2xl shadow-lg w-full max-w-md">
    <h2 class="mb-4 text-xl font-bold text-center">Acesso Restrito</h2>
    <label class="block mb-3"><span class="block mb-1">Senha de administrador</span><input id="senha" type="password" placeholder="Digite a senha"/></label>
    <button id="btnLogin" class="btn btn-primary w-full">Entrar</button>
    <p id="loginMsg" class="hidden mt-3 text-sm text-red-400 text-center">Senha incorreta.</p>
  </div>
  <main id="painel" class="hidden w-full px-4 max-w-4xl">
    <section class="bg-white/10 backdrop-blur p-6 rounded-2xl shadow-lg mb-8">
      <h2 class="mb-4 text-2xl font-bold">Adicionar Contribuição</h2>
      <form id="formContrib" class="grid md:grid-cols-2 gap-4">
        <label><span class="block mb-1">Codinome</span><input name="codinome" required/></label>
        <label><span class="block mb-1">E-mail/WhatsApp</span><input name="contato" required/></label>
        <label><span class="block mb-1">Valor (R$)</span><input name="valor" type="number" step="0.01" required/></label>
        <label><span class="block mb-1">Chave Pix</span><input name="pixKey" required/></label>
        <div class="md:col-span-2 flex justify-end"><button type="submit" class="btn btn-primary">Salvar</button></div>
      </form>
    </section>
    <section class="bg-white/10 backdrop-blur p-6 rounded-2xl shadow-lg overflow-x-auto">
      <h2 class="mb-4 text-2xl font-bold">Status de Contribuições</h2>
      <table class="min-w-full text-sm text-center">
        <thead><tr><th class="p-2">Codinome</th><th class="p-2">Valor</th><th class="p-2">Status</th><th class="p-2">Ação</th></tr></thead>
        <tbody id="tbodyContrib"></tbody>
      </table>
    </section>
  </main>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
    import { getFirestore, collection, addDoc, onSnapshot, updateDoc, doc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCjoW-Qm_MAwoj5uLS4PDGD0C6uweoS4dg",
  authDomain: "contribuicao-pix.firebaseapp.com",
  projectId: "contribuicao-pix",
  storageBucket: "contribuicao-pix.firebasestorage.app",
  messagingSenderId: "807746502345",
  appId: "1:807746502345:web:92b9bd99e0b4507f8cd718",
  measurementId: "G-02F59QDHPQ"
    };

    const app = initializeApp(firebaseConfig);
    getAnalytics(app);
    const db = getFirestore(app);
    const coll = collection(db, "contribuicoes");

    const senhaAdm = "elite2025"; // substitua aqui
    const loginCard = document.getElementById("login-card");
    const painel = document.getElementById("painel");
    const loginMsg = document.getElementById("loginMsg");
    document.getElementById("btnLogin").addEventListener("click", () => {
      if (document.getElementById("senha").value === senhaAdm) {
        loginCard.classList.add("hidden");
        painel.classList.remove("hidden");
      } else {
        loginMsg.classList.remove("hidden");
      }
    });

    document.getElementById("formContrib").addEventListener("submit", async e => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target).entries());
      data.status = "pendente";
      data.timestamp = Date.now();
      try {
        await addDoc(coll, data);
        e.target.reset();
      } catch {
        alert("Erro ao salvar contribuição.");
      }
    });

    const tbody = document.getElementById("tbodyContrib");
    onSnapshot(coll, snap => {
      tbody.innerHTML = "";
      snap.forEach(dSnap => {
        const d = dSnap.data();
        const tr = document.createElement("tr");
        tr.innerHTML = \`
          <td class="p-2">\${d.codinome}</td>
          <td class="p-2">R$ \${Number(d.valor).toFixed(2)}</td>
          <td class="p-2">\${d.status}</td>
          <td class="p-2">\${d.status === "pago" ? "-" : \`<button class='btn btn-primary' data-id="\${dSnap.id}">Marcar Pago</button>\`}</td>
        \`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll("button[data-id]").forEach(btn => {
        btn.addEventListener("click", async () => {
          try {
            await updateDoc(doc(coll, btn.dataset.id), { status: "pago" });
          } catch {
            alert("Erro ao marcar pago.");
          }
        });
      });
    });
  </script>
</body>
</html>
